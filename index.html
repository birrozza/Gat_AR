<!doctype html>
<!--  https://www.maps.ie/coordinates.html -->
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Apogei Taranto</title>
        <!--<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>-->
        <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
        <!--<script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>  per animazione-->
        <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
        <!--<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>-->
        <script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar-threex-location-only.js'></script>
        <script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js'></script>
        <style>
            .arjs-loader {
              height: 100%;
              width: 100%;
              position: absolute;
              top: 0;
              left: 0;
              /*background-color: rgba(0, 0, 0, 0.8);*/
              z-index: 9999;
              display: flex;
              justify-content: center;
              align-items: center;
            }
          
            .arjs-loader div {
              text-align: center;
              font-size: 1.25em;
              color: black;
              background-color: #999;
            }
          </style>
    </head>
    <script>
            function returnDistance(location, text){// funzione  
                let distance = location.getAttribute('distanceMsg');
                if (!distance) distance = "---"; // se ancora non l'ha calcolata
                return text + distance;
            }
	        window.addEventListener('load', () => {
                unicID = "ID-" + Date.now() + "-" + Math.round(Math.random() * 1000);
                console.log('=>', unicID);
                document.getElementById('unicID-text').setAttribute('value', unicID);
                
                const el = document.getElementById('camera');
                const lon_text = document.getElementById('lon-text');
                const lat_text = document.getElementById('lat-text');
                el.addEventListener("gps-camera-update-position", async(e) =>{
                    console.log(e)
                    lon_text.setAttribute("value", "lon: " + e.detail.position.longitude);
                    lat_text.setAttribute("value", "lat: " + e.detail.position.latitude);
                });

            	const location_temenide = document.getElementById('temenide');
            	const location_gat = document.getElementById('gat');
            	const location_vito = document.getElementById('vito');
            	const location_antonietta = document.getElementById('antonietta');
                const location_test = document.getElementById('test-img');
           	    const text_temenide = document.getElementById('text-temenide');
            	const text_officina = document.getElementById('text-officina');
            	const text_gat = document.getElementById('text-gat');
            	const text_vito = document.getElementById('text-vito');
            	const text_antonietta = document.getElementById('text-antonietta');
                const text_test = document.getElementById('text-test');
                //text_test.object3D.position.set(0, 0, 0);
            	
            	const off_line = document.getElementById('text-camera');
                
            	
            	let blink = true;
		        let blinkig = setInterval(() => {
                    blink ? off_line.setAttribute("opacity", 0): off_line.setAttribute("opacity", 1);
                    blink=!blink;                        
                }, 1000);

            	let check = setInterval(() => {
                	text_temenide.setAttribute("value", returnDistance(location_temenide, "Via Temenide "));
                	text_gat.setAttribute("value", returnDistance(location_gat, "GAT "));
                	text_vito.setAttribute("value", returnDistance(location_vito, "Casa nonno Vito "));
                	text_antonietta.setAttribute("value", returnDistance(location_antonietta, "Casa nonna Antonietta "));
                	text_test.setAttribute("value", returnDistance(location_test, "Officina "));    
                              
            	}, 100);
            });
    </script>   
    <body style="margin: 0px; overflow: hidden;">
        <div class="arjs-loader">
            <div>Loading, please wait...</div>
        </div>
        <!-- con vr-mode-ui="enabled: false" abilita la funzione VR sul display "enabled: false;"-->
        <a-scene 
            vr-mode-ui="enabled: false" 
            embedded
            loading-screen="dotsColor: red; backgroundColor: black" 
            arjs="sourceType: webcam; debugUIEnabled: false;">
            <a-camera id="camera" gps-camera = 'alert: true;' rotation-reader >   
                <a-text
                    font = "https://cdn.aframe.io/fonts/Exo2Bold.fnt"
                    position="-0.1 -0.3 -1"
                    value="Beta Test..."
                    opacity=1
                    width="1"
                    color="red"
                    id="text-camera"
                ></a-text>
                <a-text id="lat-text" value="lat: ---" width="1" color="#00ff00" position="-0.25 -0.13 -1"></a-text>
                <a-text id="lon-text" value="lon: ---" width="1" color="#00ff00" position="-0.25 -0.17 -1"></a-text> 
                <a-text id="unicID-text" value="" width="1" color="magenta" position="-0.25 -0.21 -1"></a-text>               
            </a-camera>
                <a-image
                    src="assets/location.png"
                    gps-entity-place="latitude: 40.474332; longitude: 17.2343445;"
                    look-at="[gps-camera]"
                    position="0 2.5 0"                       
                    
                    id="temenide"
                ></a-image>        
                <a-text
                    value="CASA NATIA SANT’EGIDIO"                    
                    gps-entity-place="latitude: 40.474332; longitude: 17.2343445;"
                    look-at="[gps-camera]"
                    position="1 0 0"
                    id="text-temenide"
                ></a-text>
                <!-- gat -->
                <a-image
                    src="assets/location.png"
                    look-at="[gps-camera]"
                    scale="1000 1000 1000"
                    gps-entity-place="latitude: 40.473931137786714; longitude: 17.233784821170858;"
                    id ="gat"
                ></a-image>
                <a-text
                    value="SANT’AGOSTINO"
                    look-at="[gps-camera]"
                    scale="1 1 1"
                    gps-entity-place="latitude: 40.473931137786714; longitude: 17.233784821170858;"
                    id="text-gat"
                ></a-text>
                <!--
                <a-entity gltf-model="assets/savio/test_2.gltf"                     
                    position="0 0 0"
                    rotation="0 0 0" 
                    scale=".1 .10 .10" 
                    gps-entity-place="latitude: 40.576860; longitude: 17.116746;"
                    id="head-savio"
                    color="red"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 20000; easing: linear;"
                ></a-entity>
                <a-entity gltf-model="assets/magnemite/scene.gltf" 
                    position="0 0 0"
                    rotation="0 0 0" 
                    scale=".2 .20 .20" 
                    gps-entity-place="latitude: 40.577367; longitude: 17.116729;"
                    id="magnemite"
                    color="red"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 20000; easing: linear;"
                ></a-entity>
                
                <a-text
                    value="Officina"
                    look-at="[gps-camera]"
                    scale="10 10 10"
                    gps-entity-place="latitude: 40.57748410215643; longitude: 17.116634845733646;"
                    id="text-officina"
                ></a-text>
                -->
                <a-image
                    src="assets/location.png"
                    look-at="[gps-camera]"
                    scale="10 10 10"
                    gps-entity-place="latitude: 40.4745816; longitude: 17.2318503;"
                    id="vito"
                ></a-image>
                <a-text
                    value="PALAZZO GALEOTA"
                    look-at="[gps-camera]"
                    scale="10 10 10"
                    gps-entity-place="latitude: 40.4745816; longitude: 17.2318503;"
                    id="text-vito"
                ></a-text>

                <a-image
                    src="assets/location.png"
                    look-at="[gps-camera]"
                    scale="10 10 10"
                    gps-entity-place="latitude: 40.4759083; longitude: 17.2290723;"
                    id="villa-vito"
                ></a-image>
                <a-text
                    value="PIAZZA DUOMO"
                    look-at="[gps-camera]"
                    scale="10 10 10"
                    gps-entity-place="latitude: 40.4759083; longitude: 17.2290723;"
                    id="text-villa-vito"
                ></a-text>

                <a-image
                    src="assets/location.png"
                    look-at="[gps-camera]"
                    scale="10 10 10"
                    gps-entity-place="latitude: 40.4767877; longitude: 17.227282;"
                    id="antonietta"
                ></a-image>
                <a-text
                    value="PALAZZO ULMO"
                    look-at="[gps-camera]"
                    scale="10 10 10"
                    gps-entity-place="latitude: 40.4767877; longitude: 17.227282;"
                    id="text-antonietta"
                ></a-text>

                <a-image
                src="assets/location.png"
                    look-at="[gps-camera]"
                    scale="3 3 3 "
                    gps-entity-place="latitude: 40.4768893; longitude: 17.2259746;"
                    id="uscita_emergenza_cbf"
                ></a-image>
                <a-text
                    value="PALAZZO SPARTERA"
                    look-at="[gps-camera]"
                    scale="5 5 5"
                    gps-entity-place="latitude: 40.4768893; longitude: 17.2259746;"
                    id="text-exit-cbf"
                ></a-text>

                <a-image
                    src="assets/location.png"
                    look-at="[gps-camera]"
                    scale="3 3 3 "
                    gps-entity-place="latitude:40.4750046; longitude: 17.2300906;"
                    id="uscita_emergenza_off"
                ></a-image>
                <a-text
                    value="HOTEL SAN ANDREA DEGLI ARMENI"
                    look-at="[gps-camera]"
                    scale="5 5 5"
                    gps-entity-place="latitude:40.4750046; longitude: 17.2300906;"
                    id="text-exit-off"
                ></a-text>

                <a-image
                    src="assets/location.png"
                    look-at="[gps-camera]"
                    scale="3 3 3 "
                    gps-entity-place="latitude: 40.4741673; longitude: 17.2312148;"
                    id="uscita_emergenza_combi"
                ></a-image>
                <a-text
                    value="PALAZZO STOLA"
                    look-at="[gps-camera]"
                    scale="5 5 5"
                    gps-entity-place="latitude: 40.4741673; longitude: 17.2312148;"
                    id="text-exit-combi"
                ></a-text>

                <a-image
                    src="assets/location.png"
                    look-at="[gps-camera]"
                    scale="3 3 3 "
                    gps-entity-place="latitude: 40.4736595; longitude: 17.2322077;"
                    id="alarm_img"
                ></a-image>
                <a-text
                    value="PALAZZO ANTONELLI"
                    look-at="[gps-camera]"
                    scale="10 10 10"
                    gps-entity-place="latitude: 40.4736595; longitude: 17.2322077;"
                    id="alarm"
                ></a-text>   
                
                <a-image
                    src="assets/location.png"
                    look-at="[gps-camera]"
                    scale="3 3 3 "
                    gps-entity-place="latitude: 40.4739412; longitude: 17.2315159;"
                    id="alarm_img"
                ></a-image>
                <a-text
                    value="PALAZZO BARION SANTAMATO"
                    look-at="[gps-camera]"
                    scale="10 10 10"
                    gps-entity-place="latitude: 40.4739412; longitude: 17.2315159;"
                    id="alarm"
                ></a-text> 
                <a-entity gps-entity-place="latitude: 40.4626086; longitude: 17.250842;">
                    <a-image
                        src="assets/location.png"
                        look-at="[gps-camera]"
                        
                        id="test-img"                        
                    ></a-image>
                    <a-text
                        value="test"
                        look-at="[gps-camera]"
                        scale = "2 2 2"                    
                        
                        id="text-test"
                        position="0 1 0"
                    ></a-text> 
                </a-entity>    
            
        </a-scene>
        
    </body>
</html>
