<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Apogei Taranto</title>
        <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
        <!--<script src="https://github.com/supermedium/superframe/blob/master/components/look-at/dist/aframe-look-at-component.min.js"></script>-->
        <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
        <!-- Pure three.js code that the A-Frame components use for location-based AR -->
        <script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar-threex-location-only.js'></script>

        <!-- AR.js A-Frame components -->
        <script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js'></script>
        <style>
            .arjs-loader {
              height: 100%;
              width: 100%;
              position: absolute;
              top: 0;
              left: 0;
              z-index: 9999;
              display: flex;
              justify-content: center;
              align-items: center;
            }
            .arjs-loader div {
              text-align: center;
              font-size: 1.25em;
              color: black;
              background-color: #999;
            }
        </style>
    </head>
    <script>
        const Poi = [
            {
                "name": "CASA NATIA SANTâ€™EGIDIO",
                "lon": 40.474332,
                "lat": 17.2343445
            },
            {
                "name": "test",
                "lon": 40.4626086,
                "lat": 17.250842   
            }
        ];   
        
        window.onload = () => {
            let downloaded = false; 
            const el = document.querySelector("[gps-new-camera]");

            el.addEventListener("gps-camera-update-position", async(e) => {
                if(!downloaded) {
                    Poi.map(item => {
                        const compoundEntity = document.createElement("a-entity");
                        compoundEntity.setAttribute('gps-new-entity-place', {
                            latitude: item.lat,
                            longitude: item.lon
                        });
                        
                        const img = document.createElement("a-image");
                        img.setAttribute("src", "assets/location.png"); 

                        const text = document.createElement("a-text");
                        text.setAttribute("look-at", "[gps-new-camera]");
                        text.setAttribute("value", item.name);
                        text.setAttribute("align", "center");
                        compoundEntity.appendChild(box);
                        compoundEntity.appendChild(text);
                        document.querySelector("a-scene").appendChild(compoundEntity);

                    }); // ~ map
                } // ~ if !downloaded
                downloaded = true;       
            }) // ~addEventListener
        } // ~ window.onload

    </script>
    <body style="margin: 0px; overflow: hidden;">
        <div class="arjs-loader" id="loader">
            <div>Loading data, please wait...</div>
        </div>
        <!-- con vr-mode-ui="enabled: false" abilita la funzione VR sul display -->
        <!-- videoTexure: true non abilita la cam -->
        <a-scene 
            vr-mode-ui = "enabled: false"            
            loading-screen = "enabled: false;"
            arjs="sourceType: webcam; debugUIEnabled: false; "
            >
            <a-camera  
                gps-new-camera = 'gpsMinDistance: 5'
                rotation-reader>                                
                <a-text
                    font = "https://cdn.aframe.io/fonts/Exo2Bold.fnt"
                    position="-0.2 -0.3 -1"
                    value="Server!"
                    opacity=1
                    width="2"
                    color="red"
                    id="text-camera"
                ></a-text>
                <a-plane position="-0.21 -0.17 -1" opacity="0.5" width=".5" height=".14" color="#000"></a-plane>
                <a-text id="lat-text" value="lat:   Waiting for" width="1" color="#00ff00" position="-0.45 -0.13 -1"></a-text>
                <a-text id="lon-text" value="lon:  GPS data..." width="1" color="#00ff00" position="-0.45 -0.17 -1"></a-text> 
                <a-text id="unicID-text" value="" width="1" color="magenta" position="-0.45 -0.21 -1" ></a-text>               
                <!--<a-entity position="-0.20 -0.25 -1" testo-con-sfondo="valore: Ciao Mondo"></a-entity>-->
            </a-camera>
            <!--
            <a-image
                src="assets/location.png"
                
                
                gps-entity-place="latitude: 40.4626086; longitude: 17.250842;"
                id="test-img"
            ></a-image>
            <a-text
                value="test"
                
                
                gps-entity-place="latitude: 40.4626086; longitude: 17.250842;"
                id="text-test"
            ></a-text> 
            -->
        </a-scene>
    </body>
</html>    